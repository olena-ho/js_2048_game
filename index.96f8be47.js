var t={};class e{static GAME_STATUS={IDLE:"idle",PLAYING:"playing",WIN:"win",LOSE:"lose"};static ROW_LENGTH=4;static COL_LENGTH=4;constructor(t=Array.from({length:4},()=>[,,,,].fill(0))){this.status=e.GAME_STATUS.IDLE,this.score=0,this.initialState=t.map(t=>[...t]),this.state=this.initialState.map(t=>[...t])}start(){this.status=e.GAME_STATUS.PLAYING,this.addNewCell(),this.addNewCell()}restart(){this.state=this.initialState.map(t=>[...t]),this.status=e.GAME_STATUS.IDLE,this.score=0}moveLeft(){if(this.status!==e.GAME_STATUS.PLAYING)return;let t=this.state.map(t=>[...t]);for(let t=0;t<e.ROW_LENGTH;t++){let s=this.state[t].filter(t=>0!==t);if(0!==s.length){for(let t=0;t<s.length-1;t++)0!==s[t]&&s[t]===s[t+1]&&(s[t]*=2,s[t+1]=0,this.score+=s[t]);for(s=s.filter(t=>0!==t);s.length<e.COL_LENGTH;)s.push(0);this.state[t]=s}}this.statesAreEqual(t,this.state)||this.addNewCell(),this.checkWinLose()}moveRight(){if(this.status!==e.GAME_STATUS.PLAYING)return;let t=this.state.map(t=>[...t]);for(let t=0;t<e.ROW_LENGTH;t++){let s=this.state[t].filter(t=>0!==t);if(0!==s.length){for(let t=s.length-1;t>0;t--)0!==s[t]&&s[t]===s[t-1]&&(s[t]*=2,s[t-1]=0,this.score+=s[t]);for(s=s.filter(t=>0!==t);s.length<e.COL_LENGTH;)s.unshift(0);this.state[t]=s}}this.statesAreEqual(t,this.state)||this.addNewCell(),this.checkWinLose()}moveUp(){if(this.status!==e.GAME_STATUS.PLAYING)return;let t=this.state.map(t=>[...t]);for(let t=0;t<e.COL_LENGTH;t++){let s=[];for(let a=0;a<e.ROW_LENGTH;a++)0!==this.state[a][t]&&s.push(this.state[a][t]);for(let t=0;t<s.length-1;t++)0!==s[t]&&s[t]===s[t+1]&&(s[t]*=2,s[t+1]=0,this.score+=s[t]);for(s=s.filter(t=>0!==t);s.length<e.ROW_LENGTH;)s.push(0);for(let a=0;a<e.ROW_LENGTH;a++)this.state[a][t]=s[a]}this.statesAreEqual(t,this.state)||this.addNewCell(),this.checkWinLose()}moveDown(){if(this.status!==e.GAME_STATUS.PLAYING)return;let t=this.state.map(t=>[...t]);for(let t=0;t<e.COL_LENGTH;t++){let s=[];for(let a=0;a<e.ROW_LENGTH;a++)0!==this.state[a][t]&&s.push(this.state[a][t]);for(let t=s.length-1;t>0;t--)0!==s[t]&&s[t]===s[t-1]&&(s[t]*=2,s[t-1]=0,this.score+=s[t]);for(s=s.filter(t=>0!==t);s.length<e.ROW_LENGTH;)s.unshift(0);for(let a=0;a<e.ROW_LENGTH;a++)this.state[a][t]=s[a]}this.statesAreEqual(t,this.state)||this.addNewCell(),this.checkWinLose()}statesAreEqual(t,e){return t.flat().join()===e.flat().join()}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}addNewCell(){let t=[];this.state.forEach((e,s)=>{e.forEach((e,a)=>{0===e&&t.push([s,a])})});let[e,s]=t[Math.floor(Math.random()*t.length)];this.state[e][s]=.9>Math.random()?2:4}checkWinLose(){this.state.flat().includes(2048)?this.status=e.GAME_STATUS.WIN:this.state.flat().includes(0)||this.checkMergePossible()||(this.status=e.GAME_STATUS.LOSE)}checkMergePossible(){for(let t=0;t<e.ROW_LENGTH;t++)for(let s=0;s<e.COL_LENGTH;s++)if(s<e.COL_LENGTH-1&&this.state[t][s]===this.state[t][s+1]||t<e.ROW_LENGTH-1&&this.state[t][s]===this.state[t+1][s])return!0;return!1}}const s=new(t=e),a=document.querySelector(".start"),i=document.querySelector(".message-start"),r=document.querySelector(".game-score"),l=document.querySelector(".message-win"),h=document.querySelector(".message-lose"),o=[...document.querySelectorAll(".field-cell")],n=()=>{o.forEach((e,a)=>{let i=Math.floor(a/t.COL_LENGTH),r=a%t.COL_LENGTH,l=s.state[i][r];e.textContent=l||"",e.className="field-cell",l&&e.classList.add(`field-cell--${l}`)}),r.textContent=s.getScore()},c=e=>{switch(e.key){case"ArrowUp":s.moveUp();break;case"ArrowDown":s.moveDown();break;case"ArrowLeft":s.moveLeft();break;case"ArrowRight":s.moveRight()}n(),s.status===t.GAME_STATUS.WIN?l.classList.remove("hidden"):s.status===t.GAME_STATUS.LOSE&&h.classList.remove("hidden")};a.addEventListener("click",()=>{s.status===t.GAME_STATUS.IDLE?(s.start(),a.textContent="Restart",a.classList.add("restart"),a.classList.remove("start"),i.classList.add("hidden")):(s.restart(),a.textContent="Start",h.classList.add("hidden"),l.classList.add("hidden"),a.classList.add("start"),a.classList.remove("restart"),i.classList.remove("hidden")),document.addEventListener("keydown",c),n(),s.status!==t.GAME_STATUS.PLAYING&&document.removeEventListener("keydown",c)});
//# sourceMappingURL=index.96f8be47.js.map
